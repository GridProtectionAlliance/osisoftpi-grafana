{"version":3,"file":"module.js","mappings":"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","sources":["webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"@grafana/data\"","webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"@grafana/runtime\"","webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"@grafana/ui\"","webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"lodash\"","webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"react\"","webpack://gridprotectionalliance-osisoftpi-datasource/external amd \"rxjs\"","webpack://gridprotectionalliance-osisoftpi-datasource/webpack/bootstrap","webpack://gridprotectionalliance-osisoftpi-datasource/webpack/runtime/compat get default export","webpack://gridprotectionalliance-osisoftpi-datasource/webpack/runtime/define property getters","webpack://gridprotectionalliance-osisoftpi-datasource/webpack/runtime/hasOwnProperty shorthand","webpack://gridprotectionalliance-osisoftpi-datasource/webpack/runtime/make namespace object","webpack://gridprotectionalliance-osisoftpi-datasource/./config/ConfigEditor.tsx","webpack://gridprotectionalliance-osisoftpi-datasource/./components/Forms.tsx","webpack://gridprotectionalliance-osisoftpi-datasource/./types.ts","webpack://gridprotectionalliance-osisoftpi-datasource/./components/QueryEditorModeSwitcher.tsx","webpack://gridprotectionalliance-osisoftpi-datasource/./helper.ts","webpack://gridprotectionalliance-osisoftpi-datasource/./query/QueryEditor.tsx","webpack://gridprotectionalliance-osisoftpi-datasource/./query/AnnotationsQueryEditor.tsx","webpack://gridprotectionalliance-osisoftpi-datasource/./datasource.ts","webpack://gridprotectionalliance-osisoftpi-datasource/./module.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__781__;","module.exports = __WEBPACK_EXTERNAL_MODULE__531__;","module.exports = __WEBPACK_EXTERNAL_MODULE__7__;","module.exports = __WEBPACK_EXTERNAL_MODULE__241__;","module.exports = __WEBPACK_EXTERNAL_MODULE__959__;","module.exports = __WEBPACK_EXTERNAL_MODULE__269__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import React, { ChangeEvent, PureComponent } from 'react';\nimport { LegacyForms, DataSourceHttpSettings, InlineField, InlineSwitch } from '@grafana/ui';\nimport { DataSourcePluginOptionsEditorProps, DataSourceJsonData, DataSourceSettings } from '@grafana/data';\nimport { PIWebAPIDataSourceJsonData } from '../types';\n\nconst { FormField } = LegacyForms;\n\ninterface Props extends DataSourcePluginOptionsEditorProps<PIWebAPIDataSourceJsonData, {}> {}\n\nconst coerceOptions = (\n  options: DataSourceSettings<PIWebAPIDataSourceJsonData, {}>\n): DataSourceSettings<PIWebAPIDataSourceJsonData, {}> => {\n  return {\n    ...options,\n    jsonData: {\n      ...options.jsonData,\n      url: options.url,\n    },\n  };\n};\n\ninterface State {}\n\nexport class PIWebAPIConfigEditor extends PureComponent<Props, State> {\n  onPIServerChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      piserver: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onAFServerChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      afserver: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onAFDatabaseChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      afdatabase: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onHttpOptionsChange = (options: DataSourceSettings<DataSourceJsonData, {}>) => {\n    const { onOptionsChange } = this.props;\n    onOptionsChange(coerceOptions(options));\n  };\n\n  onPiPointChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      piserver: event.target.checked ? options.jsonData.piserver : '',\n      pipoint: event.target.checked,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onNewFormatChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      newFormat: event.target.checked,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onUseUnitChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      useUnit: event.target.checked,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onUseExperimentalChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      useExperimental : event.target.checked,\n      useStreaming : event.target.checked ? options.jsonData.useStreaming : false,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onUseStreamingChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      useStreaming: event.target.checked,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  render() {\n    const { options: originalOptions } = this.props;\n    const options = coerceOptions(originalOptions);\n\n    return (\n      <div>\n        <DataSourceHttpSettings\n          defaultUrl=\"https://server.name/piwebapi\"\n          dataSourceConfig={options}\n          onChange={this.onHttpOptionsChange}\n          showAccessOptions\n        />\n\n        <h3 className=\"page-heading\">Custom Configuration</h3>\n\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form-inline\">\n            <InlineField label=\"Enable PI Points in Query\" labelWidth={24}>\n              <InlineSwitch value={options.jsonData.pipoint} onChange={this.onPiPointChange} />\n            </InlineField>\n          </div>\n          <div className=\"gf-form-inline\">\n            <InlineField label=\"Enable New Data Format\" labelWidth={24}>\n              <InlineSwitch value={options.jsonData.newFormat} onChange={this.onNewFormatChange} />\n            </InlineField>\n          </div>\n          <div className=\"gf-form-inline\">\n            <InlineField label=\"Enable Unit in Data\" labelWidth={24}>\n              <InlineSwitch value={options.jsonData.useUnit} onChange={this.onUseUnitChange} />\n            </InlineField>\n          </div>\n          <div className=\"gf-form-inline\">\n            <InlineField label=\"Enable Experimental Features\" labelWidth={24}>\n              <InlineSwitch value={options.jsonData.useExperimental} onChange={this.onUseExperimentalChange} />\n            </InlineField>\n          </div>\n          {options.jsonData.useExperimental && (\n            <div className=\"gf-form-inline\">\n              <InlineField label=\"Enable Steaming Support\" labelWidth={24}>\n                <InlineSwitch value={options.jsonData.useStreaming} onChange={this.onUseStreamingChange} />\n              </InlineField>\n            </div>\n          )}\n        </div>\n\n        <h3 className=\"page-heading\">PI/AF Connection Details</h3>\n\n        <div className=\"gf-form-group\">\n          {options.jsonData.pipoint && (\n            <div className=\"gf-form\">\n              <FormField\n                label=\"PI Server\"\n                labelWidth={10}\n                inputWidth={25}\n                onChange={this.onPIServerChange}\n                value={options.jsonData.piserver || ''}\n                placeholder=\"Default PI Server to use for data requests\"\n              />\n            </div>\n          )}\n          <div className=\"gf-form\">\n            <FormField\n              label=\"AF Server\"\n              labelWidth={10}\n              inputWidth={25}\n              onChange={this.onAFServerChange}\n              value={options.jsonData.afserver || ''}\n              placeholder=\"Default AF Server to use for data requests\"\n            />\n          </div>\n          <div className=\"gf-form\">\n            <FormField\n              label=\"AF Database\"\n              labelWidth={10}\n              inputWidth={25}\n              onChange={this.onAFDatabaseChange}\n              value={options.jsonData.afdatabase || ''}\n              placeholder=\"Default AF Database server for AF queries\"\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { InputHTMLAttributes, FunctionComponent } from 'react';\nimport { InlineFormLabel } from '@grafana/ui';\n\nexport interface Props extends InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  tooltip?: string;\n  labelWidth?: number;\n  children?: React.ReactNode;\n  queryEditor?: JSX.Element;\n}\n\nexport const QueryField: FunctionComponent<Partial<Props>> = ({ label, labelWidth = 12, tooltip, children }) => (\n  <>\n    <InlineFormLabel width={labelWidth} tooltip={tooltip}>\n      {label}\n    </InlineFormLabel>\n    {children}\n  </>\n);\n\nexport const QueryRowTerminator = () => {\n  return (\n    <div className=\"gf-form gf-form--grow\">\n      <div className=\"gf-form-label gf-form-label--grow\" />\n    </div>\n  );\n};\n\nexport const QueryInlineField = ({ ...props }) => {\n  return (\n    <QueryEditorRow>\n      <QueryField {...props} />\n    </QueryEditorRow>\n  );\n};\n\nexport const QueryEditorRow = (props: Partial<Props>) => {\n  return (\n    <div className=\"gf-form-inline\">\n      {props.children}\n      <QueryRowTerminator />\n    </div>\n  );\n};\n\nexport const QueryRawInlineField = ({ ...props }) => {\n  return (\n    <QueryRawEditorRow>\n      <QueryField {...props} />\n    </QueryRawEditorRow>\n  );\n};\n\nexport const QueryRawEditorRow = (props: Partial<Props>) => {\n  return <>{props.children}</>;\n};\n","import { DataQuery } from '@grafana/schema';\nimport { DataSourceJsonData, SelectableValue } from '@grafana/data';\n\nexport interface PiwebapiElementPath {\n  path: string;\n  variable: string;\n}\n\nexport interface PiwebapiInternalRsp {\n  data: PiwebapiRsp;\n  status: number;\n  url: string;\n}\n\nexport interface PiwebapiRsp {\n  Name?: string;\n  InstanceType?: string;\n  Items?: PiwebapiRsp[];\n  WebId?: string;\n  HasChildren?: boolean;\n  Type?: string;\n  DefaultUnitsName?: string;\n  Description?: string;\n  Path?: string;\n}\n\nexport interface PiDataServer {\n  name: string | undefined;\n  webid: string | undefined;\n}\n\nexport interface PIWebAPISelectableValue {\n  webId?: string;\n  value?: string;\n  type?: string;\n  expandable?: boolean;\n}\n\nexport interface PIWebAPIAnnotationsQuery extends DataQuery {\n  target: string;\n}\n\nexport interface PIWebAPIQuery extends DataQuery {\n  target?: string;\n  elementPath?: string;\n  attributes?: Array<SelectableValue<PIWebAPISelectableValue>>;\n  segments?: any[];\n  isPiPoint?: boolean;\n  hideError?: boolean;\n  isAnnotation?: boolean;\n  webid?: string;\n  display?: any;\n  interpolate?: any;\n  recordedValues?: any;\n  digitalStates?: any;\n  enableStreaming: any;\n  useLastValue?: any;\n  useUnit?: any;\n  regex?: any;\n  summary?: {\n    nodata?: string,\n    types?: any[],\n    basis?: string,\n    interval?: string\n  };\n  expression?: string;\n  rawQuery?: boolean;\n  query?: string;\n  // annotations items\n  database?: PiwebapiRsp;\n  template?: PiwebapiRsp;\n  showEndTime?: boolean;\n  attribute?: any;\n  nameFilter?: string;\n  categoryName?: string;\n}\n\nexport const defaultQuery: Partial<PIWebAPIQuery> = {\n  target: ';',\n  attributes: [],\n  segments: [],\n  regex: { enable: false },\n  summary: { types: [], basis: 'EventWeighted', interval: '', nodata: 'Null' },\n  expression: '',\n  interpolate: { enable: false },\n  useLastValue: { enable: false },\n  recordedValues: { enable: false, boundaryType: 'Inside' },\n  digitalStates: { enable: false },\n  enableStreaming: { enable: false },\n  useUnit: { enable: false },\n  isPiPoint: false,\n};\n\n/**\n * These are options configured for each DataSource instance\n */\nexport interface PIWebAPIDataSourceJsonData extends DataSourceJsonData {\n  url?: string;\n  access?: string;\n  piserver?: string;\n  afserver?: string;\n  afdatabase?: string;\n  pipoint?: boolean;\n  newFormat?: boolean;\n  useUnit?: boolean;\n  useExperimental?: boolean;\n  useStreaming?: boolean;\n}\n\n/**\n * Value that is used in the backend, but never sent over HTTP to the frontend\n */\nexport interface PIWebAPISecureJsonData {\n  apiKey?: string;\n}\n","import React, { useEffect, useState } from 'react';\nimport { Button, ConfirmModal } from '@grafana/ui';\n\ntype Props = {\n  isRaw: boolean;\n  onChange: (newIsRaw: boolean) => void;\n};\n\nexport const QueryEditorModeSwitcher = ({ isRaw, onChange }: Props): JSX.Element => {\n  const [isModalOpen, setModalOpen] = useState(false);\n\n  useEffect(() => {\n    // if the isRaw changes, we hide the modal\n    setModalOpen(false);\n  }, [isRaw]);\n\n  if (isRaw) {\n    return (\n      <>\n        <Button\n          aria-label=\"Switch to visual editor\"\n          icon=\"pen\"\n          variant=\"secondary\"\n          type=\"button\"\n          onClick={() => {\n            // we show the are-you-sure modal\n            setModalOpen(true);\n          }}\n        ></Button>\n        <ConfirmModal\n          isOpen={isModalOpen}\n          title=\"Switch to visual editor mode\"\n          body=\"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.\"\n          confirmText=\"Yes, switch to editor mode\"\n          dismissText=\"No, stay in raw query mode\"\n          onConfirm={() => {\n            onChange(false);\n          }}\n          onDismiss={() => {\n            setModalOpen(false);\n          }}\n        />\n      </>\n    );\n  } else {\n    return (\n      <Button\n        aria-label=\"Switch to text editor\"\n        icon=\"pen\"\n        variant=\"secondary\"\n        type=\"button\"\n        onClick={() => {\n          onChange(true);\n        }}\n      ></Button>\n    );\n  }\n};\n","import { each, map } from 'lodash';\r\n\r\nimport {\r\n  AnnotationQuery,\r\n  DataFrame,\r\n  TableData,\r\n  MetricFindValue,\r\n  Field,\r\n  toDataFrame,\r\n} from '@grafana/data';\r\n\r\nimport { PiwebapiElementPath, PiwebapiRsp, PIWebAPIQuery } from 'types';\r\n\r\nexport function parseRawQuery(tr: string): any {\r\n  const splitAttributes = tr.split(';');\r\n  const splitElements = splitAttributes[0].split('\\\\');\r\n\r\n  // remove element hierarchy from attribute collection\r\n  splitAttributes.splice(0, 1);\r\n\r\n  let attributes: any[] = [];\r\n  if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\r\n    const elementPath: string = splitElements.join('\\\\');\r\n    each(splitAttributes, function (item, index) {\r\n      if (item !== '') {\r\n        attributes.push({\r\n          label: item,\r\n          value: {\r\n            value: item,\r\n            expandable: false,\r\n          },\r\n        });\r\n      }\r\n    });\r\n\r\n    return { attributes, elementPath };\r\n  }\r\n\r\n  return { attributes, elementPath: null };\r\n}\r\n\r\nexport function lowerCaseFirstLetter(string: string): string {\r\n  return string.charAt(0).toLocaleLowerCase() + string.slice(1);\r\n}\r\n\r\n/**\r\n * Builds the Grafana metric segment for use on the query user interface.\r\n *\r\n * @param {any} response - response from PI Web API.\r\n * @returns - Grafana metric segment.\r\n *\r\n * @memberOf PiWebApiDatasource\r\n */\r\nexport function metricQueryTransform(response: PiwebapiRsp[]): MetricFindValue[] {\r\n  return map(response, (item) => {\r\n    return {\r\n      text: item.Name,\r\n      expandable:\r\n        item.HasChildren === undefined || item.HasChildren === true || (item.Path ?? '').split('\\\\').length <= 3,\r\n      HasChildren: item.HasChildren,\r\n      Items: item.Items ?? [],\r\n      Path: item.Path,\r\n      WebId: item.WebId,\r\n    } as MetricFindValue;\r\n  });\r\n}\r\n\r\n/**\r\n * Check if all items are selected.\r\n *\r\n * @param {any} current the current variable selection\r\n * @return {boolean} true if all value is selected, false otherwise\r\n */\r\nexport function isAllSelected(current: any): boolean {\r\n  if (!current) {\r\n    return false;\r\n  }\r\n  if (Array.isArray(current.text)) {\r\n    return current.text.indexOf('All') >= 0;\r\n  }\r\n  return current.text === 'All';\r\n}\r\n\r\nexport function processAnnotationQuery(annon: AnnotationQuery<PIWebAPIQuery>,data: DataFrame[]): DataFrame[] {\r\n  let processedFrames: DataFrame[] = [];\r\n  \r\n  data.forEach((d: DataFrame) => {\r\n    d.fields.forEach((f: Field) => {\r\n\r\n      // check if the label has been set, if it hasn't been set then the eventframe annotation is not valid. \r\n      if (!f.labels) { \r\n        return \r\n      }\r\n\r\n      if (!('eventframe' in f.labels)) {\r\n        return;\r\n      }\r\n\r\n      let attribute = 'attribute' in f.labels\r\n\r\n      // Check whether f.values is an array or not to allow for each.\r\n      // Check whether f.values is an array or not to allow for each.\r\n      if (Array.isArray(f.values)) {\r\n        f.values.forEach((value: any) => {\r\n\r\n          if (attribute) {\r\n            let annotation = value['1'].Content\r\n            let valueData:  any[] = []\r\n            for (let i = 2; i in value; i++) {\r\n              valueData.push(value[i].Content.Items)\r\n            }\r\n\r\n            const processedFrame = convertToTableData(annotation.Items!, valueData).map((r) => {\r\n              return toDataFrame(r)});\r\n            processedFrames = processedFrames.concat(processedFrame);\r\n          } else {\r\n            let annotation = value['1'].Content\r\n            const processedFrame = convertToTableData(annotation.Items!).map((r) => {\r\n              return toDataFrame(r)});\r\n            processedFrames = processedFrames.concat(processedFrame);\r\n          }\r\n        });\r\n      } \r\n    });\r\n  });\r\n  return processedFrames;\r\n}\r\n\r\nexport function convertToTableData(items: any[], valueData?: any[]): TableData[] {\r\n  const response: TableData[] = items.map((item: any, index: number) => {\r\n    const columns = [{ text: 'StartTime' }, { text: 'EndTime' }];\r\n    const rows = [item.StartTime, item.EndTime];\r\n    if (valueData) {\r\n      for (let attributeIndex = 0; attributeIndex < valueData.length; attributeIndex++) {\r\n          let attributeData = valueData[attributeIndex]\r\n          let eventframeAributeData = attributeData[index].Content.Items\r\n          eventframeAributeData.forEach((attribute: any) => {\r\n            columns.push({ text: attribute.Name });\r\n            rows.push(String(attribute.Value.Value ? attribute.Value.Value.Name || attribute.Value.Value.Value || attribute.Value.Value : ''));\r\n          });\r\n      }\r\n    }\r\n\r\n    return {\r\n      name: item.Name,\r\n      columns,\r\n      rows: [rows],\r\n    };\r\n  });\r\n  return response;\r\n}\r\n\r\n/**\r\n * Resolve PIWebAPI response 'value' data to value - timestamp pairs.\r\n *\r\n * @param {any} item - 'Item' object from PIWebAPI\r\n * @param {any} noDataReplacementMode - String state of how to replace 'No Data'\r\n * @param {any} grafanaDataPoint - Single Grafana value pair (value, timestamp).\r\n * @returns grafanaDataPoint - Single Grafana value pair (value, timestamp).\r\n * @returns perviousValue - {any} Grafana value (value only).\r\n *\r\n */\r\nexport function noDataReplace(\r\n  item: any,\r\n  noDataReplacementMode: any,\r\n  grafanaDataPoint: any[]\r\n): {\r\n  grafanaDataPoint: any[];\r\n  previousValue: any;\r\n  drop: boolean;\r\n} {\r\n  let previousValue = null;\r\n  let drop = false;\r\n  if (!item.Good || item.Value === 'No Data' || (item.Value?.Name && item.Value?.Name === 'No Data')) {\r\n    if (noDataReplacementMode === 'Drop') {\r\n      drop = true;\r\n    } else if (noDataReplacementMode === '0') {\r\n      grafanaDataPoint[0] = 0;\r\n    } else if (noDataReplacementMode === 'Keep') {\r\n      // Do nothing keep\r\n    } else if (noDataReplacementMode === 'Null') {\r\n      grafanaDataPoint[0] = null;\r\n    } else if (noDataReplacementMode === 'Previous' && previousValue !== null) {\r\n      grafanaDataPoint[0] = previousValue;\r\n    }\r\n  } else {\r\n    previousValue = item.Value;\r\n  }\r\n  return { grafanaDataPoint, previousValue, drop };\r\n}\r\n\r\n/**\r\n * Check if the value is a number.\r\n *\r\n * @param {any} number the value to check\r\n * @returns {boolean} true if the value is a number, false otherwise\r\n */\r\nexport function checkNumber(number: any): boolean {\r\n  return typeof number === 'number' && !Number.isNaN(number) && Number.isFinite(number);\r\n}\r\n\r\n/**\r\n * Returns the last item of the element path.\r\n *\r\n * @param {string} path element path\r\n * @returns {string} last item of the element path\r\n */\r\nexport function getLastPath(path: string): string {\r\n  let splitPath = path.split('|');\r\n  if (splitPath.length === 0) {\r\n    return '';\r\n  }\r\n  splitPath = splitPath[0].split('\\\\');\r\n  return splitPath.length === 0 ? '' : splitPath.pop() ?? '';\r\n}\r\n\r\n/**\r\n * Returns the last item of the element path plus variable.\r\n *\r\n * @param {PiwebapiElementPath[]} elementPathArray array of element paths\r\n * @param {string} path element path\r\n * @returns {string} last item of the element path\r\n */\r\nexport function getPath(elementPathArray: PiwebapiElementPath[], path: string): string {\r\n  if (!path || elementPathArray.length === 0) {\r\n    return '';\r\n  }\r\n  const splitStr = getLastPath(path);\r\n  const foundElement = elementPathArray.find((e) => path.indexOf(e.path) >= 0)?.variable;\r\n  return foundElement ? foundElement + '|' + splitStr : splitStr;\r\n}\r\n\r\n/**\r\n * Replace calculation dot in expression with PI point name.\r\n *\r\n * @param {boolean} replace - is pi point and calculation.\r\n * @param {PiwebapiRsp} webid - Pi web api response object.\r\n * @param {string} url - original url.\r\n * @returns Modified url\r\n */\r\nexport function getFinalUrl(replace: boolean, webid: PiwebapiRsp, url: string) {\r\n  const newUrl = replace ? url.replace(/'\\.'/g, `'${webid.Name}'`) : url;\r\n  return newUrl;\r\n}\r\n","import { each, filter, forOwn, join, reduce, map, slice, remove, defaults } from 'lodash';\n\nimport React, { PureComponent, ChangeEvent } from 'react';\nimport { Icon, InlineField, InlineFieldRow, InlineSwitch, Input, SegmentAsync, Segment } from '@grafana/ui';\nimport { QueryEditorProps, SelectableValue, TypedVariableModel } from '@grafana/data';\n\nimport { PiWebAPIDatasource } from '../datasource';\nimport { QueryInlineField, QueryRawInlineField, QueryRowTerminator } from '../components/Forms';\nimport { PIWebAPISelectableValue, PIWebAPIDataSourceJsonData, PIWebAPIQuery, defaultQuery } from '../types';\nimport { QueryEditorModeSwitcher } from 'components/QueryEditorModeSwitcher';\nimport { parseRawQuery } from 'helper';\n\nconst LABEL_WIDTH = 24;\nconst LABEL_SWITCH_WIDTH = 49.067 / 8.0;\nconst MIN_ELEM_INPUT_WIDTH = 200;\nconst MIN_ATTR_INPUT_WIDTH = 250;\n\ninterface State {\n  isPiPoint: boolean;\n  hideError: boolean;\n  segments: Array<SelectableValue<PIWebAPISelectableValue>>;\n  attributes: Array<SelectableValue<PIWebAPISelectableValue>>;\n  summaries: Array<SelectableValue<PIWebAPISelectableValue>>;\n  attributeSegment: SelectableValue<PIWebAPISelectableValue>;\n  summarySegment: SelectableValue<PIWebAPISelectableValue>;\n  calculationBasisSegment: SelectableValue<PIWebAPISelectableValue>;\n  noDataReplacementSegment: SelectableValue<PIWebAPISelectableValue>;\n}\n\ntype Props = QueryEditorProps<PiWebAPIDatasource, PIWebAPIQuery, PIWebAPIDataSourceJsonData>;\n\nconst REMOVE_LABEL = '-REMOVE-';\n\nconst CustomLabelComponent = (props: any) => {\n  if (props.value) {\n    return (\n      <div \n        style={{width: props.width, marginRight: props.marginRight}} \n        className={`gf-form-label ${props.value.type === 'template' ? 'query-keyword' : ''}`}>\n        {props.label ?? '--no label--'}\n      </div>\n    );\n  }\n  return (\n    <a className=\"gf-form-label query-part\">\n      <Icon name=\"plus\" />\n    </a>\n  );\n};\n\nexport class PIWebAPIQueryEditor extends PureComponent<Props, State> {\n  error: any;\n  piServer: any[] = [];\n  availableAttributes: any = {};\n  summaryTypes: string[];\n  calculationBasis: string[];\n  recordedBoundaryTypes: string [];\n  noDataReplacement: string[];\n  state: State = {\n    isPiPoint: false,\n    hideError: false,\n    segments: [],\n    attributes: [],\n    summaries: [],\n    attributeSegment: {},\n    summarySegment: {},\n    calculationBasisSegment: {},\n    noDataReplacementSegment: {},\n  };\n\n  constructor(props: any) {\n    super(props);\n    this.onSegmentChange = this.onSegmentChange.bind(this);\n    this.calcBasisValueChanged = this.calcBasisValueChanged.bind(this);\n    this.recordedBoundaryTypeValueChanged = this.recordedBoundaryTypeValueChanged.bind(this);\n    this.calcNoDataValueChanged = this.calcNoDataValueChanged.bind(this);\n    this.onSummaryAction = this.onSummaryAction.bind(this);\n    this.onSummaryValueChanged = this.onSummaryValueChanged.bind(this);\n    this.onAttributeAction = this.onAttributeAction.bind(this);\n    this.onAttributeChange = this.onAttributeChange.bind(this);\n\n    this.summaryTypes = [\n      // 'None', // A summary type is not specified.\n      'Total', // A totalization over the time range.\n      'Average', // The average value over the time range.\n      'Minimum', // The minimum value over the time range.\n      'Maximum', // The maximum value over the time range.\n      'Range', // The range value over the time range (minimum-maximum).\n      'StdDev', // The standard deviation over the time range.\n      'PopulationStdDev', // The population standard deviation over the time range.\n      'Count', // The sum of event count over the time range when calculation basis is event weighted. The sum of event time duration over the time range when calculation basis is time weighted.\n      'PercentGood', // Percent of data with good value during the calculation period. For time weighted calculations, the percentage is based on time. For event weighted calculations, the percent is based on event count.\n      'All', // A convenience for requesting all available summary calculations.\n      'AllForNonNumeric', // A convenience for requesting all available summary calculations for non-numeric data.\n    ];\n\n    this.calculationBasis = [\n      'TimeWeighted', // Weight the values in the calculation by the time over which they apply. Interpolation is based on whether the attribute is stepped. Interpolated events are generated at the boundaries if necessary.\n      'EventWeighted', // Evaluate values with equal weighting for each event. No interpolation is done. There must be at least one event within the time range to perform a successful calculation. Two events are required for standard deviation. In handling events at the boundary of the calculation, the AFSDK uses following rules:\n      'TimeWeightedContinuous', // Apply weighting as in TimeWeighted, but do all interpolation between values as if they represent continuous data, (standard interpolation) regardless of whether the attribute is stepped.\n      'TimeWeightedDiscrete', // Apply weighting as in TimeWeighted but interpolation between values is performed as if they represent discrete, unrelated values (stair step plot) regardless of the attribute is stepped.\n      'EventWeightedExcludeMostRecentEvent', // The calculation behaves the same as _EventWeighted_, except in the handling of events at the boundary of summary intervals in a multiple intervals calculation. Use this option to prevent events at the intervals boundary from being double count at both intervals. With this option, events at the end time (most recent time) of an interval is not used in that interval.\n      'EventWeightedExcludeEarliestEvent', // Similar to the option _EventWeightedExcludeMostRecentEvent_. Events at the start time(earliest time) of an interval is not used in that interval.\n      'EventWeightedIncludeBothEnds', // Events at both ends of the interval boundaries are included in the event weighted calculation.\n    ];\n\n    this.recordedBoundaryTypes = [\n      'Inside', // Default. Specifies to return the recorded values on the inside of the requested time range as the first and last values. \n      'Outside', // Specifies to return the recorded values on the outside of the requested time range as the first and last values.\n      'Interpolated', //Specifies to create an interpolated value at the end points of the requested time range if a recorded value does not exist at that time.\n    ]\n\n    this.noDataReplacement = [\n      'Null', // replace with nulls\n      'Drop', // drop items\n      'Previous', // use previous value if available\n      '0', // replace with 0\n      'Keep', // Keep value\n    ];\n  }\n\n  // is selected segment empty\n  isValueEmpty(value: PIWebAPISelectableValue | undefined) {\n    return !value || !value.value || !value.value.length || value.value === REMOVE_LABEL;\n  }\n\n  segmentChangeValue = (segments: Array<SelectableValue<PIWebAPISelectableValue>>) => {\n    const query = this.props.query;\n    this.setState({ segments }, () => this.onChange({ ...query, segments }));\n  };\n\n  attributeChangeValue = (attributes: Array<SelectableValue<PIWebAPISelectableValue>>): Promise<void> => {\n    const query = this.props.query;\n    return new Promise((resolve) => this.setState({ attributes }, () => {\n      this.onChange({ ...query, attributes })\n      resolve();\n    }));\n  };\n\n  // summary calculation basis change event\n  calcBasisValueChanged(segment: SelectableValue<PIWebAPISelectableValue>) {\n    const metricsQuery = this.props.query as PIWebAPIQuery;\n    const summary = metricsQuery.summary;\n    if (summary) {\n      summary.basis = segment.value?.value;\n    }\n    this.onChange({ ...metricsQuery, summary });\n  }\n  // get summary calculation basis user interface segments\n  getCalcBasisSegments() {\n    const segments = map(this.calculationBasis, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n    return segments;\n  }\n\n  // recorded boundary type change event\n  recordedBoundaryTypeValueChanged(segment: SelectableValue<PIWebAPISelectableValue>) {\n    const metricsQuery = this.props.query as PIWebAPIQuery;\n    const recordedValues = metricsQuery.recordedValues;\n    if (recordedValues) {\n      recordedValues.boundaryType = segment.value?.value;\n    }\n    this.onChange({ ...metricsQuery, recordedValues });\n  }\n  // get recorded boundary type user interface segments\n  getRecordedBoundaryTypeSegments() {\n    const segments = map(this.recordedBoundaryTypes, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n    return segments;\n  }\n\n  // no data change event\n  calcNoDataValueChanged(segment: SelectableValue<PIWebAPISelectableValue>) {\n    const metricsQuery = this.props.query as PIWebAPIQuery;\n    const summary = metricsQuery.summary;\n    if (summary) {\n      summary.nodata = segment.value?.value;\n    }\n    this.onChange({ ...metricsQuery, summary });\n  }\n  // get no data user interface segments\n  getNoDataSegments() {\n    const segments = map(this.noDataReplacement, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n    return segments;\n  }\n\n  // summary query change event\n  onSummaryValueChanged(item: SelectableValue<PIWebAPISelectableValue>, index: number) {\n    const summaries = this.state.summaries.slice(0) as Array<SelectableValue<PIWebAPISelectableValue>>;\n    summaries[index] = item;\n    if (this.isValueEmpty(item.value)) {\n      summaries.splice(index, 1);\n    }\n    this.setState({ summaries }, this.stateCallback);\n  }\n  // get the list of summaries available\n  getSummarySegments() {\n    const summaryTypes = filter(this.summaryTypes, (type) => {\n      return this.state.summaries.map((s) => s.value?.value).indexOf(type) === -1;\n    });\n\n    const segments = map(summaryTypes, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n\n    segments.unshift({\n      label: REMOVE_LABEL,\n      value: {\n        value: REMOVE_LABEL,\n      },\n    });\n\n    return segments;\n  }\n\n  // remove a summary from the user interface and the query\n  removeSummary(part: SelectableValue<PIWebAPISelectableValue>) {\n    const summaries = filter(this.state.summaries, (item: SelectableValue<PIWebAPISelectableValue>) => {\n      return item !== part;\n    });\n    this.setState({ summaries });\n  }\n  // add a new summary to the query\n  onSummaryAction(item: SelectableValue<PIWebAPISelectableValue>) {\n    const summaries = this.state.summaries.slice(0) as Array<SelectableValue<PIWebAPISelectableValue>>;\n    // if value is not empty, add new attribute segment\n    if (!this.isValueEmpty(item.value)) {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item.label,\n        value: {\n          value: item.value?.value,\n          expandable: true,\n        },\n      };\n      summaries.push(selectableValue);\n    }\n    this.setState({ summarySegment: {}, summaries }, this.stateCallback);\n  }\n\n  // remove an attribute from the query\n  removeAttribute(part: SelectableValue<PIWebAPISelectableValue>) {\n    const attributes = filter(this.state.attributes, (item: SelectableValue<PIWebAPISelectableValue>) => {\n      return item !== part;\n    });\n    this.attributeChangeValue(attributes);\n  }\n  // add an attribute to the query\n  onAttributeAction(item: SelectableValue<PIWebAPISelectableValue>) {\n    const { query } = this.props;\n    const attributes = this.state.attributes.slice(0);\n    // partial variable\n    if (item.value !== null && typeof item.value !== 'object' && !Array.isArray(item.value)) {\n      const value = String(item.value! as string);\n      item.value = {\n        type: value.match(/\\${\\w+}/gi) ? 'template' : undefined,\n        value: value,\n      }\n    }\n\n    // if value is not empty, add new attribute segment\n    if (!this.isValueEmpty(item.value)) {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item.label,\n        value: {\n          type: item.value?.value && item.value?.value.match(/\\${\\w+}/gi) ? 'template' : undefined,\n          value: item.value?.value,\n          expandable: !query.isPiPoint,\n        },\n      };\n      attributes.push(selectableValue);\n    }\n    this.attributeChangeValue(attributes);\n  }\n\n  // pi point change event\n  onPiPointChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    let attributes = this.state.attributes.slice(0);\n\n    if (item.label === REMOVE_LABEL) {\n      remove(attributes, (_, n) => n === index);\n    } else {\n      // set current value\n      attributes[index] = item;\n    }\n\n    this.checkPiPointSegments(item, attributes);\n  };\n  // attribute change event\n  onAttributeChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    let attributes = this.state.attributes.slice(0);\n\n    // ignore if no change\n    if (attributes[index].label === item.value?.value) {\n      return;\n    }\n\n    // set current value\n    attributes[index] = item;\n\n    this.checkAttributeSegments(attributes, this.state.segments);\n  };\n  // segment change\n  onSegmentChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    const { query } = this.props;\n    let segments = this.state.segments.slice(0);\n\n    // partial variable\n    if (item.value !== null && typeof item.value !== 'object' && !Array.isArray(item.value)) {\n      const value = String(item.value! as string);\n      item.value = {\n        type: value.match(/\\${\\w+}/gi) ? 'template' : undefined,\n        value: value,\n      }\n    }\n\n    // ignore if no change\n    if (segments[index].label === item.value?.value) {\n      return;\n    }\n\n    // reset attributes list\n    this.setState({ attributes: [] }, () => {\n      if (item.label === REMOVE_LABEL) {\n        segments = slice(segments, 0, index);\n        this.checkAttributeSegments([], segments).then(() => {\n          if (segments.length === 0) {\n            segments.push({\n              label: '',\n            });\n          } else if (!!segments[segments.length - 1].value?.expandable) {\n            segments.push({\n              label: 'Select Element',\n              value: {\n                value: '-Select Element-',\n              },\n            });\n          }\n          if (query.isPiPoint) {\n            this.piServer = [];\n          }\n          this.segmentChangeValue(segments);\n        });\n        return;\n      }\n\n      // set current value\n      segments[index] = item;\n\n      // Accept only one PI server\n      if (query.isPiPoint) {\n        this.piServer.push(item);\n        this.segmentChangeValue(segments);\n        return;\n      }\n\n      // changed internal selection\n      if (index < segments.length - 1) {\n        segments = slice(segments, 0, index + 1);\n      }\n      this.checkAttributeSegments([], segments).then((): Promise<Array<SelectableValue<PIWebAPISelectableValue>>> => {\n        // add new options\n        if (item.value?.type === 'template') { // if it's a variable we need to check for new elements\\\n          return this.getElementSegments(segments.length + 1, segments).then((elements) => {\n            if (elements.length > 0) {\n              segments[index].value!.expandable = true;\n              segments.push({\n                label: 'Select Element',\n                value: {\n                  value: '-Select Element-',\n                },\n              });\n            }\n            this.segmentChangeValue(segments);\n            return segments;\n          });\n        } else if (!!item.value?.expandable) {\n          segments.push({\n            label: 'Select Element',\n            value: {\n              value: '-Select Element-',\n            },\n          });\n        }\n        return new Promise((resolve) => {\n          this.segmentChangeValue(segments);\n          resolve(segments);\n        });\n      });\n    });\n  };\n\n  // get a ui segment for the attributes\n  getElementSegments = (\n    index: number,\n    currentSegment?: Array<SelectableValue<PIWebAPISelectableValue>>\n  ): Promise<Array<SelectableValue<PIWebAPISelectableValue>>> => {\n    const { datasource, query, data } = this.props;\n    const ctrl = this;\n    const findQuery = query.isPiPoint\n      ? { type: 'dataserver' }\n      : {\n          path: this.getSegmentPathUpTo(currentSegment ?? this.state.segments.slice(0), index),\n          afServerWebId: this.state.segments.length > 0 && this.state.segments[0].value ? this.state.segments[0].value.webId : undefined,\n        };\n\n    if (!query.isPiPoint) {\n      if (datasource.afserver?.name && index === 0) {\n        return Promise.resolve([\n          {\n            label: datasource.afserver.name,\n            value: {\n              value: datasource.afserver.name,\n              expandable: true,\n            },\n          },\n        ]);\n      }\n      if (datasource.afserver?.name && datasource.afdatabase?.name && index === 1) {\n        return Promise.resolve([\n          {\n            label: datasource.afdatabase.name,\n            value: {\n              value: datasource.afdatabase.name,\n              expandable: true,\n            },\n          },\n        ]);\n      }\n    }\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: query.isPiPoint }))\n      .then((items: any[]) => {\n        const altSegments = map(items, (item: any) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            label: item.text,\n            value: {\n              webId: item.WebId,\n              value: item.text,\n              expandable: !query.isPiPoint && item.expandable,\n            },\n          };\n          return selectableValue;\n        });\n\n        if (altSegments.length === 0) {\n          return altSegments;\n        }\n\n        // add template variables\n        const variables = datasource.templateSrv.getVariables();\n        each(variables, (variable: TypedVariableModel) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            label: '${' + variable.name + '}',\n            value: {\n              type: 'template',\n              value: '${' + variable.name + '}',\n              expandable: !query.isPiPoint,\n            },\n          };\n          altSegments.unshift(selectableValue);\n        });\n\n        // add remove label\n        altSegments.unshift({\n          label: REMOVE_LABEL,\n          value: {\n            value: REMOVE_LABEL,\n          },\n        });\n\n        return altSegments;\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return [];\n      });\n  };\n\n  // get the list of attributes for the user interface - PI\n  getAttributeSegmentsPI = (attributeText?: string): Promise<Array<SelectableValue<PIWebAPISelectableValue>>> => {\n    const { datasource, query, data } = this.props;\n    const ctrl = this;\n    const findQuery = {\n      path: '',\n      webId: this.getSelectedPIServer(),\n      pointName: (attributeText ?? '') + '*',\n      type: 'pipoint',\n    };\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: query.isPiPoint }))\n      .then((items: any[]) => {\n        segments = map(items, (item: any) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            path: item.Path,\n            label: item.text,\n            value: {\n              value: item.text,\n              expandable: false,\n            },\n          };\n          return selectableValue;\n        });\n        if (!!attributeText && attributeText.length > 0) {\n          segments.unshift({\n            label: attributeText,\n            value: {\n              value: attributeText,\n              expandable: false,\n            },\n          });\n        }\n        // add template variables\n        const variables = datasource.templateSrv.getVariables();\n        each(variables, (variable: TypedVariableModel) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            label: '${' + variable.name + '}',\n            value: {\n              type: 'template',\n              value: '${' + variable.name + '}',\n              expandable: !query.isPiPoint,\n            },\n          };\n          segments.unshift(selectableValue);\n        });\n\n        // add remove label\n        segments.unshift({\n          label: REMOVE_LABEL,\n          value: {\n            value: REMOVE_LABEL,\n          },\n        });\n\n        return segments;\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return segments;\n      });\n  };\n\n  // get the list of attributes for the user interface - AF\n  getAttributeSegmentsAF = (attributeText?: string): Array<SelectableValue<PIWebAPISelectableValue>> => {\n    const { datasource } = this.props;\n    const ctrl = this;\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n\n    segments.push({\n      label: REMOVE_LABEL,\n      value: {\n        value: REMOVE_LABEL,\n      },\n    });\n\n    // add template variables\n    const variables = datasource.templateSrv.getVariables();\n    each(variables, (variable: TypedVariableModel) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: '${' + variable.name + '}',\n        value: {\n          type: 'template',\n          value: '${' + variable.name + '}',\n          expandable: false,\n        },\n      };\n      segments.push(selectableValue);\n    });\n\n    forOwn(ctrl.availableAttributes, (val: any, key: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: key,\n        value: {\n          value: key,\n          expandable: true,\n        },\n      };\n      segments.push(selectableValue);\n    });\n\n    return segments;\n  };\n\n  // build data from target string\n  buildFromTarget = (\n    query: PIWebAPIQuery,\n    segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    attributesArray: Array<SelectableValue<PIWebAPISelectableValue>>\n  ) => {\n    const splitAttributes = query.target!.split(';');\n    const splitElements = splitAttributes.length > 0 ? splitAttributes[0].split('\\\\') : [];\n\n    if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\n      // remove element hierarchy from attribute collection\n      splitAttributes.splice(0, 1);\n\n      each(splitElements, (item, _) => {\n        segmentsArray.push({\n          label: item,\n          value: {\n            type: item.match(/\\${\\w+}/gi) ? 'template' : undefined,\n            value: item,\n            expandable: true,\n          },\n        });\n      });\n      each(splitAttributes, (item, _) => {\n        if (item !== '') {\n          // set current value\n          attributesArray.push({\n            label: item,\n            value: {\n              type: item.match(/\\${\\w+}/gi) ? 'template' : undefined,\n              value: item,\n              expandable: false,\n            },\n          });\n        }\n      });\n      return this.getElementSegments(splitElements.length + 1, segmentsArray).then((elements) => {\n        if (elements.length > 0) {\n          segmentsArray.push({\n            label: 'Select Element',\n            value: {\n              value: '-Select Element-',\n            },\n          });\n        }\n        return segmentsArray;\n      });\n    }\n    return Promise.resolve(segmentsArray);\n  };\n\n  /**\n   * Gets the segment information and parses it to a string.\n   *\n   * @param {any} index - Last index of segment to use.\n   * @returns - AF Path or PI Point name.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  getSegmentPathUpTo(segments: Array<SelectableValue<PIWebAPISelectableValue>>, index: number): string {\n    const arr = segments.slice(0, index);\n\n    return reduce(\n      arr,\n      (result: any, segment: SelectableValue<PIWebAPISelectableValue>) => {\n        if (!segment.value) {\n          return '';\n        }\n        if (!segment.value.value?.startsWith('-Select')) {\n          return result ? result + '\\\\' + segment.value.value : segment.value.value;\n        }\n        return result;\n      },\n      ''\n    );\n  }\n\n  /**\n   * Get the current AF Element's child attributes. Validates when the element selection changes.\n   *\n   * @returns - Collection of attributes.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  checkAttributeSegments(\n    attributes: Array<SelectableValue<PIWebAPISelectableValue>>,\n    segments: Array<SelectableValue<PIWebAPISelectableValue>>\n  ): Promise<any> {\n    const { datasource, data } = this.props;\n    const ctrl = this;\n    const findQuery = {\n      path: this.getSegmentPathUpTo(segments.slice(0), segments.length),\n      type: 'attributes',\n    };\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: false }))\n      .then((attributesResponse: any) => {\n        const validAttributes: any = {};\n\n        each(attributesResponse, (attribute: any) => {\n          validAttributes[attribute.Path.substring(attribute.Path.indexOf('|') + 1)] = attribute.WebId;\n        });\n\n        const filteredAttributes = filter(attributes, (attrib: SelectableValue<PIWebAPISelectableValue>) => {\n          const changedValue = datasource.templateSrv.replace(attrib.value?.value);\n          return validAttributes[changedValue] !== undefined;\n        });\n\n        ctrl.availableAttributes = validAttributes;\n        return this.attributeChangeValue(filteredAttributes);\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return this.attributeChangeValue(attributes);\n      });\n  }\n\n  /**\n   * Get PI points from server.\n   *\n   * @returns - Collection of attributes.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  checkPiPointSegments(\n    attribute: SelectableValue<PIWebAPISelectableValue>,\n    attributes: Array<SelectableValue<PIWebAPISelectableValue>>\n  ) {\n    const { datasource, data } = this.props;\n    const ctrl = this;\n    const findQuery = {\n      path: attribute.path,\n      webId: ctrl.getSelectedPIServer(),\n      pointName: attribute.label,\n      type: 'pipoint',\n    };\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: true }))\n      .then(() => {\n        return ctrl.attributeChangeValue(attributes);\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return ctrl.attributeChangeValue([]);\n      });\n  }\n\n  /**\n   * Gets the webid of the current selected pi data server.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  getSelectedPIServer() {\n    let webID = '';\n\n    this.piServer.forEach((s) => {\n      const parts = this.props.query.target!.split(';');\n      if (parts.length >= 2) {\n        if (parts[0] === s.text) {\n          webID = s.WebId;\n          return;\n        }\n      }\n    });\n    return this.piServer.length > 0 ? this.piServer[0].value?.webId : webID;\n  }\n\n  /**\n   * Queries PI Web API for child elements and attributes when the raw query text editor is changed.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  textEditorChanged() {\n    const { query } = this.props;\n    const splitAttributes = query.target!.split(';');\n    const splitElements = splitAttributes.length > 0 ? splitAttributes[0].split('\\\\') : [];\n\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n    let attributes: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n\n    if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\n      // remove element hierarchy from attribute collection\n      splitAttributes.splice(0, 1);\n\n      each(splitElements, (item, _) => {\n        segments.push({\n          label: item,\n          value: {\n            type: item.match(/\\${\\w+}/gi) ? 'template' : undefined,\n            value: item,\n            expandable: true,\n          },\n        });\n      });\n      each(splitAttributes, function (item, index) {\n        if (item !== '') {\n          attributes.push({\n            label: item,\n            value: {\n              type: item.match(/\\${\\w+}/gi) ? 'template' : undefined,\n              value: item,\n              expandable: false,\n            },\n          });\n        }\n      });\n      this.getElementSegments(splitElements.length + 1, segments)\n        .then((elements) => {\n          if (elements.length > 0) {\n            segments.push({\n              label: 'Select Element',\n              value: {\n                value: '-Select Element-',\n              },\n            });\n          }\n        })\n        .then(() => {\n          this.updateArray(segments, attributes, this.state.summaries, query.isPiPoint!, () => {\n            this.onChange({\n              ...query,\n              query: undefined,\n              rawQuery: false,\n              attributes: this.state.attributes,\n              segments: this.state.segments,\n            });\n          });\n        });\n    } else {\n      segments = this.checkAfServer();\n      this.updateArray(segments, this.state.attributes, this.state.summaries, query.isPiPoint!, () => {\n        this.onChange({\n          ...query,\n          query: undefined,\n          rawQuery: false,\n          attributes: this.state.attributes,\n          segments: this.state.segments,\n        });\n      });\n    }\n  }\n\n  /**\n   * Check if the AF server and database are configured in the datasoure config.\n   *\n   * @returns the segments array\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  checkAfServer = () => {\n    const { datasource } = this.props;\n    const segmentsArray = [];\n    if (datasource.afserver?.name) {\n      segmentsArray.push({\n        label: datasource.afserver.name,\n        value: {\n          value: datasource.afserver.name,\n          expandable: true,\n        },\n      });\n      if (datasource.afdatabase?.name) {\n        segmentsArray.push({\n          label: datasource.afdatabase.name,\n          value: {\n            value: datasource.afdatabase.name,\n            expandable: true,\n          },\n        });\n      }\n      segmentsArray.push({\n        label: 'Select Element',\n        value: {\n          value: '-Select Element-',\n        },\n      });\n    } else {\n      segmentsArray.push({\n        label: '',\n      });\n    }\n    return segmentsArray;\n  };\n\n  /**\n   * Update the internal state of the datasource.\n   *\n   * @param segmentsArray the segments array to update\n   * @param attributesArray the AF attributes array to update\n   * @param summariesArray the summaries array to update\n   * @param isPiPoint the is PI point flag\n   * @param cb optional callback function\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  updateArray = (\n    segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    attributesArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    summariesArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    isPiPoint: boolean,\n    cb?: (() => void) | undefined\n  ) => {\n    this.setState(\n      {\n        segments: segmentsArray,\n        attributes: attributesArray,\n        summaries: summariesArray,\n        isPiPoint,\n      },\n      () => {\n        if (!isPiPoint) {\n          this.checkAttributeSegments(attributesArray, this.state.segments).then(() => {\n            if (cb) {\n              cb();\n            }\n          });\n        }\n      }\n    );\n  };\n\n  // React action when component is initialized/updated\n  scopedVarsDone = false;\n  componentDidMount = () => {\n    this.initialLoad(false);\n  };\n\n  componentDidUpdate = () => {\n    const { query } = this.props;\n    if (this.props.data?.state === 'Done' && !!this.props.data?.request?.scopedVars && !this.scopedVarsDone) {\n      this.scopedVarsDone = true;\n      this.initialLoad(!query.isPiPoint);\n    }\n  };\n\n  initialLoad = (force: boolean) => {\n    const { query } = this.props;\n    const metricsQuery = defaults(query, defaultQuery) as PIWebAPIQuery;\n    const { segments, attributes, summary, isPiPoint } = metricsQuery;\n\n    let segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>> = force ? [] : segments?.slice(0) ?? [];\n    let attributesArray: Array<SelectableValue<PIWebAPISelectableValue>> = force ? [] : attributes?.slice(0) ?? [];\n    let summariesArray = summary?.types ?? [];\n\n    if (!isPiPoint && segmentsArray.length === 0) {\n      if (query.target && query.target.length > 0 && query.target !== ';') {\n        attributesArray = [];\n        // Build query from target\n        this.buildFromTarget(query, segmentsArray, attributesArray)\n          .then((_segmentsArray) => {\n            this.updateArray(_segmentsArray, attributesArray, summariesArray, false);\n          })\n          .catch((e) => console.error(e));\n        return;\n      } else {\n        segmentsArray = this.checkAfServer();\n      }\n    } else if (isPiPoint && segmentsArray.length > 0) {\n      this.piServer = segmentsArray;\n    }\n    this.updateArray(segmentsArray, attributesArray, summariesArray, !!isPiPoint, () => {\n      this.onChange(query);\n    });\n  };\n\n  onChange = (query: PIWebAPIQuery) => {\n    const { onChange, onRunQuery } = this.props;\n\n    if (query.rawQuery) {\n      query.target = query.query ?? '';\n      if (!!query.query) {\n        const { attributes, elementPath } = parseRawQuery(query.target);\n        query.attributes = attributes;\n        query.elementPath = elementPath;\n      }\n    } else {\n      query.elementPath = this.getSegmentPathUpTo(this.state.segments, this.state.segments.length);\n      query.target =\n        query.elementPath +\n        ';' +\n        join(\n          query.attributes?.map((s) => s.value?.value),\n          ';'\n        );\n    }\n    const summary = query.summary;\n    if (summary) {\n      summary.types = this.state.summaries;\n    }\n\n    onChange({...query, summary});\n\n    if (this.isValidQuery(query)) {\n      onRunQuery();\n    }\n  };\n\n  isValidQuery = (query: PIWebAPIQuery): boolean => {\n    if (query.target && query.target.length > 0 && query.target !== \";\") {\n      query.target = query.target.trim();\n      const targetSplit = query.target.split(\";\", 2);\n      return targetSplit.length === 2 && targetSplit[0].length > 0 && targetSplit[1].length > 0;\n    }\n    return false;\n  }\n\n  stateCallback = () => {\n    const query = this.props.query as PIWebAPIQuery;\n    this.onChange(query);\n  };\n\n  onIsPiPointChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const { query: queryChange } = this.props;\n    const isPiPoint = !queryChange.isPiPoint;\n    this.setState(\n      {\n        segments: isPiPoint ? [{ label: '' }] : this.checkAfServer(),\n        attributes: [],\n        isPiPoint,\n      },\n      () => {\n        this.onChange({\n          ...queryChange,\n          expression: '',\n          attributes: this.state.attributes,\n          segments: this.state.segments,\n          isPiPoint,\n        });\n      }\n    );\n  };\n\n  onHideErrorChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const { query: queryChange } = this.props;\n    const hideError = !queryChange.hideError;\n    this.setState(\n      {\n        hideError,\n      },\n      () => {\n        this.onChange({\n          ...queryChange,\n          hideError,\n        });\n      }\n    );\n  };\n\n  render() {\n    const { query: queryProps, onChange, onRunQuery } = this.props;\n    const metricsQuery = defaults(queryProps, defaultQuery) as PIWebAPIQuery;\n    const {\n      useLastValue,\n      useUnit,\n      interpolate,\n      query,\n      rawQuery,\n      digitalStates,\n      enableStreaming,\n      recordedValues,\n      expression,\n      isPiPoint,\n      hideError,\n      summary,\n      display,\n      regex,\n    } = metricsQuery;\n\n    return (\n      <>\n        {this.props.datasource.piPointConfig && (\n          <InlineField label=\"Is Pi Point?\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch value={isPiPoint} onChange={this.onIsPiPointChange} />\n          </InlineField>\n        )}\n\n        {!!rawQuery && (\n          <InlineFieldRow>\n            <InlineField label=\"Raw Query\" labelWidth={LABEL_WIDTH} grow={true}>\n              <Input\n                onBlur={this.stateCallback}\n                value={query}\n                onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                  onChange({ ...metricsQuery, query: event.target.value })\n                }\n                placeholder=\"enter query\"\n              />\n            </InlineField>\n            <QueryEditorModeSwitcher isRaw={true} onChange={(value: boolean) => this.textEditorChanged()} />\n          </InlineFieldRow>\n        )}\n\n        {!rawQuery && (\n          <>\n            <div className=\"gf-form-inline\">\n              <QueryRawInlineField\n                label={isPiPoint ? 'PI Server' : 'AF Elements'}\n                tooltip={isPiPoint ? 'Select PI server.' : 'Select AF Element.'}\n              >\n                {this.state.segments.map((segment: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                  return (\n                    <SegmentAsync\n                      key={'element-' + index}\n                      Component={<CustomLabelComponent value={segment.value} label={segment.label} />}\n                      onChange={(item) => this.onSegmentChange(item, index)}\n                      loadOptions={(query?: string | undefined) => {\n                        return this.getElementSegments(index);\n                      }}\n                      allowCustomValue\n                      inputMinWidth={MIN_ELEM_INPUT_WIDTH}\n                    />\n                  );\n                })}\n                <QueryRowTerminator />\n                {!isPiPoint && (\n                  <QueryEditorModeSwitcher\n                    isRaw={false}\n                    onChange={(value: boolean) => {\n                      onChange({ ...metricsQuery, query: metricsQuery.target, rawQuery: value });\n                    }}\n                  />\n                )}\n              </QueryRawInlineField>\n            </div>\n\n            <QueryInlineField label={isPiPoint ? 'Pi Points' : 'Attributes'}>\n              {this.state.attributes.map((attribute: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                if (isPiPoint) {\n                  return (\n                    <SegmentAsync\n                      key={'attributes-' + index}\n                      Component={<CustomLabelComponent value={attribute.value} label={attribute.label} />}\n                      disabled={this.piServer.length === 0}\n                      onChange={(item) => this.onPiPointChange(item, index)}\n                      loadOptions={this.getAttributeSegmentsPI}\n                      reloadOptionsOnChange\n                      allowCustomValue\n                      inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                    />\n                  );\n                }\n                return (\n                  <Segment\n                    key={'attributes-' + index}\n                    Component={<CustomLabelComponent value={attribute.value} label={attribute.label} />}\n                    disabled={this.state.segments.length <= 2}\n                    onChange={(item) => this.onAttributeChange(item, index)}\n                    options={this.getAttributeSegmentsAF()}\n                    allowCustomValue\n                    inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                  />\n                );\n              })}\n\n              {isPiPoint && (\n                <SegmentAsync\n                  Component={\n                    <CustomLabelComponent\n                      value={this.state.attributeSegment.value}\n                      label={this.state.attributeSegment.label}\n                    />\n                  }\n                  disabled={this.piServer.length === 0}\n                  onChange={this.onAttributeAction}\n                  loadOptions={this.getAttributeSegmentsPI}\n                  reloadOptionsOnChange\n                  allowCustomValue\n                  inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                />\n              )}\n              {!isPiPoint && (\n                <Segment\n                  Component={\n                    <CustomLabelComponent\n                      value={this.state.attributeSegment.value}\n                      label={this.state.attributeSegment.label}\n                    />\n                  }\n                  disabled={this.state.segments.length <= 2}\n                  onChange={this.onAttributeAction}\n                  options={this.getAttributeSegmentsAF()}\n                  allowCustomValue\n                  inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                />\n              )}\n            </QueryInlineField>\n          </>\n        )}\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Calculation\"\n            grow={true}\n            labelWidth={LABEL_WIDTH}\n            tooltip={\n              \"Modify all attributes by an equation. Use '.' for current item. Leave Attributes empty if you wish to perform element based calculations.\"\n            }\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={expression}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                onChange({ ...metricsQuery, expression: event.target.value })\n              }\n              placeholder=\"'.'*2\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Use Last Value\"\n            tooltip={\"Fetch only last value from time range\"}\n            labelWidth={LABEL_WIDTH}\n          >\n            <InlineSwitch\n              value={useLastValue.enable}\n              onChange={() =>\n                this.onChange({\n                  ...metricsQuery,\n                  useLastValue: { ...useLastValue, enable: !useLastValue.enable },\n                })\n              }\n            />\n          </InlineField>\n          <InlineField label=\"Digital States\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={digitalStates.enable}\n              onChange={() =>\n                this.onChange({\n                  ...metricsQuery,\n                  digitalStates: { ...digitalStates, enable: !digitalStates.enable },\n                })\n              }\n            />\n          </InlineField>\n          <InlineField\n            label=\"Replace Bad Data\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={'Replacement for bad quality values.'}\n          >\n            <Segment\n              Component={\n                <CustomLabelComponent\n                  width={LABEL_WIDTH * 4}\n                  value={{ value: summary?.nodata }}\n                  label={summary?.nodata}\n                />\n              }\n              onChange={this.calcNoDataValueChanged}\n              options={this.getNoDataSegments()}\n              allowCustomValue\n            />\n          </InlineField>\n          <InlineField label=\"Ignore API Error?\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch value={hideError} onChange={this.onHideErrorChange} />\n          </InlineField>\n          {this.props.datasource.useUnitConfig && (\n            <InlineField\n              label=\"Use unit from datapoints\"\n              tooltip={\"Use unit in label from PI tag or PI AF attribute\"}\n              labelWidth={LABEL_WIDTH}\n            >\n              <InlineSwitch\n                value={useUnit.enable}\n                onChange={() =>\n                  this.onChange({\n                    ...metricsQuery,\n                    useUnit: { ...useUnit, enable: !useUnit.enable },\n                  })\n                }\n              />\n            </InlineField>\n          )}\n          {this.props.datasource.useStreaming && (\n            <InlineField \n              label=\"Enable Streaming\" \n              labelWidth={LABEL_WIDTH}\n              tooltip={'Enable streaming data if it is supported for the point type.'}\n            >\n              <InlineSwitch\n                value={enableStreaming.enable}\n                onChange={() =>\n                  this.onChange({ ...metricsQuery, enableStreaming: { ...enableStreaming, enable: !enableStreaming.enable } })\n                }\n              />\n            </InlineField>\n          )}\n        </InlineFieldRow>\n        \n        {!useLastValue.enable && !recordedValues.enable && (\n          <InlineFieldRow>\n            <InlineField label={!!expression ? \"Interval Values\" : \"Interpolate\"} labelWidth={LABEL_WIDTH}>\n              <InlineSwitch\n                value={interpolate.enable}\n                onChange={() =>\n                  this.onChange({ ...metricsQuery, interpolate: { ...interpolate, enable: !interpolate.enable, interval: null } })\n                }\n              />\n            </InlineField>\n            <InlineField\n              disabled={!interpolate.enable}\n              label={!!expression ? \"Interval Period\" : \"Interpolate Period\"}\n              labelWidth={LABEL_WIDTH}\n              tooltip={\"Override time between sampling, e.g. '30s'. Defaults to timespan/chart width.\"}\n            >\n              <Input\n                onBlur={onRunQuery}\n                width={LABEL_WIDTH + LABEL_SWITCH_WIDTH + 0.5}\n                value={interpolate.interval}\n                onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                  onChange({ ...metricsQuery, interpolate: { ...interpolate, interval: event.target.value } })\n                }\n                placeholder=\"30s\"\n              />\n            </InlineField>\n          </InlineFieldRow>\n        )}\n\n        {!useLastValue.enable && !interpolate.enable && (\n          <InlineFieldRow>\n            <InlineField label=\"Recorded Values\" labelWidth={LABEL_WIDTH}>\n              <InlineSwitch\n                value={recordedValues.enable}\n                onChange={() =>\n                  this.onChange({\n                    ...metricsQuery,\n                    recordedValues: { ...recordedValues, enable: !recordedValues.enable, maxNumber: null, boundaryType: 'Inside' },\n                  })\n                }\n              />\n            </InlineField>\n            <InlineField\n              disabled={!recordedValues?.enable}\n              label=\"Max Recorded Values\"\n              labelWidth={LABEL_WIDTH}\n              tooltip={\n                'Maximum number of recorded value to retrive from the data archive, without using interpolation.'\n              }\n            >\n              <Input\n                onBlur={onRunQuery}\n                width={LABEL_WIDTH + LABEL_SWITCH_WIDTH + 0.5}\n                value={recordedValues.maxNumber}\n                onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                  onChange({\n                    ...metricsQuery,\n                    recordedValues: { ...recordedValues, maxNumber: parseInt(event.target.value, 10) },\n                  })\n                }\n                type=\"number\"\n                placeholder=\"1000\"\n              />\n            </InlineField>\n            <InlineField\n              disabled={!recordedValues?.enable}\n              label=\"Boundary Type\"\n              labelWidth={LABEL_WIDTH}\n              tooltip={\n                'Defines the behavior of data retrieval at the end points of a specified time range.'\n              }\n              >\n                <Segment\n                  Component={\n                    <CustomLabelComponent\n                      width={LABEL_WIDTH * 4}\n                      value={{ value: recordedValues?.boundaryType }}\n                      label={recordedValues?.boundaryType}\n                    />\n                  }\n                  onChange={this.recordedBoundaryTypeValueChanged}\n                  options={this.getRecordedBoundaryTypeSegments()}\n                  allowCustomValue\n                />\n            </InlineField>\n          </InlineFieldRow>\n        )}\n\n        {!useLastValue.enable && (\n          <InlineFieldRow>\n            <InlineField\n              label=\"Summary Period\"\n              labelWidth={LABEL_WIDTH}\n              tooltip={\"Define the summary period, e.g. '30s'.\"}\n            >\n              <Input\n                onBlur={onRunQuery}\n                width={LABEL_WIDTH + (LABEL_SWITCH_WIDTH + 0.5)}\n                value={summary?.interval}\n                onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                  onChange({ ...metricsQuery, summary: { ...summary, interval: event.target.value } })\n                }\n                placeholder=\"30s\"\n              />\n            </InlineField>\n            <InlineField\n              label=\"Basis\"\n              labelWidth={LABEL_WIDTH + LABEL_SWITCH_WIDTH + 0.5}\n              tooltip={\n                'Defines the possible calculation options when performing summary calculations over time-series data.'\n              }\n            >\n              <Segment\n                Component={\n                  <CustomLabelComponent\n                    width={LABEL_WIDTH * 8}\n                    marginRight=\"0\"\n                    value={{ value: summary?.basis }}\n                    label={summary?.basis}\n                  />\n                }\n                onChange={this.calcBasisValueChanged}\n                options={this.getCalcBasisSegments()}\n                allowCustomValue\n              />\n            </InlineField>\n            <InlineField label=\"Summaries\" labelWidth={LABEL_WIDTH} tooltip={'PI Web API summary options.'}>\n              <InlineFieldRow>\n                {this.state.summaries.map((s: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                  return (\n                    <Segment\n                      key={'summaries-' + index}\n                      Component={<CustomLabelComponent value={s.value} label={s.label} />}\n                      onChange={(item) => this.onSummaryValueChanged(item, index)}\n                      options={this.getSummarySegments()}\n                      allowCustomValue\n                    />\n                  );\n                })}\n                <Segment\n                  Component={\n                    <CustomLabelComponent\n                      value={this.state.summarySegment.value}\n                      label={this.state.summarySegment.label}\n                    />\n                  }\n                  onChange={this.onSummaryAction}\n                  options={this.getSummarySegments()}\n                  allowCustomValue\n                />\n              </InlineFieldRow>\n            </InlineField>\n          </InlineFieldRow>\n        )}\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Display Name\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={'If single attribute, modify display name. Otherwise use regex to modify display name.'}\n          >\n            <Input\n              onBlur={onRunQuery}\n              width={LABEL_WIDTH + (LABEL_SWITCH_WIDTH + 0.5)}\n              value={display}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                onChange({ ...metricsQuery, display: event.target.value })\n              }\n              placeholder=\"Display\"\n            />\n          </InlineField>\n          <InlineField label=\"Enable Regex Replace\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={regex.enable}\n              onChange={() => {\n                this.onChange({ ...metricsQuery, regex: { ...regex, enable: !regex.enable } });\n              }}\n            />\n          </InlineField>\n          <InlineField label=\"Search\" labelWidth={LABEL_WIDTH}>\n            <Input\n              onBlur={onRunQuery}\n              width={LABEL_WIDTH}\n              value={regex.search}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                onChange({ ...metricsQuery, regex: { ...regex, search: event.target.value } })\n              }\n              placeholder=\"(.*)\"\n            />\n          </InlineField>\n          <InlineField label=\"Replace\" labelWidth={LABEL_WIDTH}>\n            <Input\n              onBlur={onRunQuery}\n              width={LABEL_WIDTH}\n              value={regex.replace}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                onChange({ ...metricsQuery, regex: { ...regex, replace: event.target.value } })\n              }\n              placeholder=\"$1\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </>\n    );\n  }\n}\n","import React, { memo, useState } from 'react';\n\nimport { AnnotationQuery, QueryEditorProps, SelectableValue } from '@grafana/data';\nimport { AsyncSelect, InlineField, InlineFieldRow, InlineSwitch, Input } from '@grafana/ui';\n\nimport { PiWebAPIDatasource } from 'datasource';\nimport { PIWebAPIDataSourceJsonData, PIWebAPIQuery, PiwebapiRsp } from 'types';\n\nconst SMALL_LABEL_WIDTH = 20;\nconst LABEL_WIDTH = 30;\nconst MIN_INPUT_WIDTH = 50;\n\ntype PiWebAPIQueryEditorProps = QueryEditorProps<PiWebAPIDatasource, PIWebAPIQuery, PIWebAPIDataSourceJsonData>;\n\ntype Props = PiWebAPIQueryEditorProps & {\n  annotation?: AnnotationQuery<PIWebAPIQuery>;\n  onAnnotationChange?: (annotation: AnnotationQuery<PIWebAPIQuery>) => void;\n};\n\nexport const PiWebAPIAnnotationsQueryEditor = memo(function PiWebAPIAnnotationQueryEditor(props: Props) {\n  const { query, datasource, annotation, onChange, onRunQuery } = props;\n\n  const [afWebId, setAfWebId] = useState<string>('');\n  const [database, setDatabase] = useState<PiwebapiRsp>(annotation?.target?.database ?? {});\n\n  // this should never happen, but we want to keep typescript happy\n  if (annotation === undefined) {\n    return null;\n  }\n\n  const getEventFrames = (): Promise<Array<SelectableValue<PiwebapiRsp>>> => {\n    return datasource.getEventFrameTemplates(database?.WebId!).then((templ: PiwebapiRsp[]) => {\n      return templ.map((d) => ({ label: d.Name, value: d }));\n    });\n  };\n\n  const getDatabases = (): Promise<Array<SelectableValue<PiwebapiRsp>>> => {\n    return datasource.getDatabases(afWebId).then((dbs: PiwebapiRsp[]) => {\n      return dbs.map((d) => ({ label: d.Name, value: d }));\n    });\n  };\n\n  const getValue = (key: string) => {\n    const query: any = annotation.target as any;\n    if (!query || !query[key]) {\n      return;\n    }\n    return { label: query[key].Name, value: query[key] };\n  };\n\n  datasource.getAssetServer(datasource.afserver.name).then((result) => {\n    setAfWebId(result.WebId!);\n  });\n\n  return (\n    <>\n      <div className=\"gf-form-group\">\n        <InlineFieldRow>\n          <InlineField label=\"Database\" labelWidth={LABEL_WIDTH} grow={true}>\n            <AsyncSelect\n              key={afWebId ?? 'database-key'}\n              loadOptions={getDatabases}\n              loadingMessage={'Loading'}\n              value={getValue('database')}\n              onChange={(e) => {\n                setDatabase(e.value);\n                onChange({ ...query, database: e.value, template: undefined });\n              }}\n              defaultOptions\n            />\n          </InlineField>\n          <InlineField label=\"Event Frames\" labelWidth={LABEL_WIDTH} grow={true}>\n            <AsyncSelect\n              key={database?.WebId ?? 'default-template-key'}\n              loadOptions={getEventFrames}\n              loadingMessage={'Loading'}\n              value={getValue('template')}\n              onChange={(e) => onChange({ ...query, template: e.value })}\n              defaultOptions\n            />\n          </InlineField>\n          <InlineField label=\"Show Start and End Time\" labelWidth={LABEL_WIDTH} grow={true}>\n            <InlineSwitch\n              value={!!query.showEndTime}\n              onChange={(e) => onChange({ ...query, showEndTime: e.currentTarget.checked })}\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Category name\" labelWidth={LABEL_WIDTH} grow={true}>\n            <Input\n              type=\"text\"\n              value={query.categoryName}\n              onBlur={(e) => onRunQuery()}\n              onChange={(e) => onChange({ ...query, categoryName: e.currentTarget.value })}\n              placeholder=\"Enter category name\"\n            />\n          </InlineField>\n          <InlineField label=\"Name Filter\" labelWidth={LABEL_WIDTH} grow={true}>\n            <Input\n              type=\"text\"\n              value={query.nameFilter}\n              onBlur={(e) => onRunQuery()}\n              onChange={(e) => onChange({ ...query, nameFilter: e.currentTarget.value })}\n              placeholder=\"Enter name filter\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Enable Name Regex Replacement\" labelWidth={LABEL_WIDTH} grow={false}>\n            <InlineSwitch\n              value={query.regex?.enable}\n              onChange={(e) =>\n                onChange({\n                  ...query,\n                  regex: { ...query.regex, enable: e.currentTarget.checked },\n                })\n              }\n            />\n          </InlineField>\n          <InlineField label=\"Name Filter\" labelWidth={SMALL_LABEL_WIDTH} grow={false}>\n            <Input\n              type=\"text\"\n              value={query.regex?.search}\n              onBlur={(e) => onRunQuery()}\n              onChange={(e) =>\n                onChange({\n                  ...query,\n                  regex: { ...query.regex, search: e.currentTarget.value },\n                })\n              }\n              placeholder=\"(.*)\"\n              width={MIN_INPUT_WIDTH}\n            />\n          </InlineField>\n          <InlineField label=\"Replace\" labelWidth={SMALL_LABEL_WIDTH} grow={true}>\n            <Input\n              type=\"text\"\n              value={query?.regex?.replace}\n              onBlur={(e) => onRunQuery()}\n              onChange={(e) =>\n                onChange({\n                  ...query,\n                  regex: { ...query.regex, replace: e.currentTarget.value },\n                })\n              }\n              placeholder=\"$1\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n        <InlineFieldRow>\n          <InlineField label=\"Enable Attribute Usage\" labelWidth={LABEL_WIDTH} grow={false}>\n            <InlineSwitch\n              value={query.attribute?.enable}\n              onChange={(e) =>\n                onChange({\n                  ...query!,\n                  attribute: { ...query.attribute, enable: e.currentTarget.checked },\n                })\n              }\n            />\n          </InlineField>\n          <InlineField label=\"Attribute Name\" labelWidth={LABEL_WIDTH} grow={true}>\n            <Input\n              type=\"text\"\n              value={query.attribute?.name}\n              onBlur={(e) => onRunQuery()}\n              onChange={(e) =>\n                onChange({\n                  ...query!,\n                  attribute: { ...query.attribute, name: e.currentTarget.value },\n                })\n              }\n              placeholder=\"Enter name\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </div>\n    </>\n  );\n});\n","import { filter, map } from 'lodash';\n\nimport { Observable, of } from 'rxjs';\n\nimport {\n  DataSourceInstanceSettings,\n  MetricFindValue,\n  AnnotationQuery,\n  ScopedVars,\n  AnnotationEvent,\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n} from '@grafana/data';\nimport { getTemplateSrv, TemplateSrv, DataSourceWithBackend } from '@grafana/runtime';\n\nimport { PIWebAPIQuery, PIWebAPIDataSourceJsonData, PiDataServer, PiwebapiRsp } from './types';\nimport { metricQueryTransform } from 'helper';\n\nimport { PiWebAPIAnnotationsQueryEditor } from 'query/AnnotationsQueryEditor';\n\nexport class PiWebAPIDatasource extends DataSourceWithBackend<PIWebAPIQuery, PIWebAPIDataSourceJsonData> {\n  piserver: PiDataServer;\n  afserver: PiDataServer;\n  afdatabase: PiDataServer;\n  piPointConfig: boolean;\n  newFormatConfig: boolean;\n  useUnitConfig: boolean;\n  useExperimental: boolean;\n  useStreaming: boolean;\n\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<PIWebAPIDataSourceJsonData>,\n    readonly templateSrv: TemplateSrv = getTemplateSrv()\n  ) {\n    super(instanceSettings);\n\n    this.piserver = { name: (instanceSettings.jsonData || {}).piserver, webid: undefined };\n    this.afserver = { name: (instanceSettings.jsonData || {}).afserver, webid: undefined };\n    this.afdatabase = { name: (instanceSettings.jsonData || {}).afdatabase, webid: undefined };\n    this.piPointConfig = instanceSettings.jsonData.pipoint || false;\n    this.newFormatConfig = instanceSettings.jsonData.newFormat || false;\n    this.useUnitConfig = instanceSettings.jsonData.useUnit || false;\n    this.useExperimental = instanceSettings.jsonData.useExperimental || false;\n    this.useStreaming = instanceSettings.jsonData.useStreaming || false;\n\n    this.annotations = {\n      QueryEditor: PiWebAPIAnnotationsQueryEditor,\n      prepareQuery(anno: AnnotationQuery<PIWebAPIQuery>): PIWebAPIQuery | undefined {\n        if (anno.target) {\n          anno.target.queryType = 'Annotation';\n          anno.target.isAnnotation = true;\n        }\n        return anno.target;\n      },\n      processEvents: (\n        anno: AnnotationQuery<PIWebAPIQuery>,\n        data: DataFrame[]\n      ): Observable<AnnotationEvent[] | undefined> => {\n        return of(this.eventFrameToAnnotation(anno, data));\n      },\n    };\n\n    Promise.all([\n      this.getDataServer(this.piserver.name).then((result: PiwebapiRsp) => (this.piserver.webid = result.WebId)),\n      this.getAssetServer(this.afserver.name).then((result: PiwebapiRsp) => (this.afserver.webid = result.WebId)),\n      this.getDatabase(\n        this.afserver.name && this.afdatabase.name ? this.afserver.name + '\\\\' + this.afdatabase.name : undefined\n      ).then((result: PiwebapiRsp) => (this.afdatabase.webid = result.WebId)),\n    ]);\n  }\n\n  /**\n   * This method overrides the applyTemplateVariables() method from the DataSourceWithBackend class.\n   * It is responsible for replacing the template variables in the query configuration prior\n   * to sending the query to the backend. Templated variables are not able to be used for alerts\n   * or public facing dashboards.\n   *\n   * @param {PIWebAPIQuery} query - The raw query configuration from the frontend as defined in the query editor.\n   * @param {ScopedVars} scopedVars - The template variables that are defined in the query editor and dashboard.\n   * @returns - PIWebAPIQuery.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  applyTemplateVariables(query: PIWebAPIQuery, scopedVars: ScopedVars) {\n    return {\n      ...query,\n      target: query.target ? this.templateSrv.replace(query.target, scopedVars) : '',\n    };\n  }\n\n  /**\n   * This method makes the query to the backend.\n   *\n   * @param {DataQueryRequest<PIWebAPIQuery>}  options\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  query(options: DataQueryRequest<PIWebAPIQuery>): Observable<DataQueryResponse> {\n    if (options.targets.length === 1 && !!options.targets[0].isAnnotation) {\n      return super.query(options);\n    }\n\n    const query = this.buildQueryParameters(options);\n    if (query.targets.length <= 0) {\n      return of({ data: [] });\n    }\n\n    return super.query(query);\n  }\n\n  /**\n   * This method does the discovery of the AF Hierarchy and populates the query user interface segments.\n   *\n   * @param {any} query - Parses the query configuration and builds a PI Web API query.\n   * @returns - Segment information.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  metricFindQuery(query: any, queryOptions: any): Promise<MetricFindValue[]> {\n    const ds = this;\n    const querydepth = ['servers', 'databases', 'databaseElements', 'elements'];\n    if (typeof query === 'string') {\n      query = JSON.parse(query as string);\n    }\n    if (queryOptions.isPiPoint) {\n      query.path = this.templateSrv.replace(query.path, queryOptions);\n    } else {\n      if (query.path === '') {\n        query.type = querydepth[0];\n      } else {\n        query.path = this.templateSrv.replace(query.path, queryOptions); // replace variables in the path\n        query.path = query.path.split(';')[0]; // if the attribute is in the path, let's remote it\n        if (query.type !== 'attributes') {\n          query.type = querydepth[Math.max(0, Math.min(query.path.split('\\\\').length, querydepth.length - 1))];\n        }\n      }\n      query.path = query.path.replace(/\\{([^\\\\])*\\}/gi, (r: string) => r.substring(1, r.length - 2).split(',')[0]);\n    }\n\n    query.filter = query.filter ?? '*';\n    query.max = query.max ?? 10000;\n\n    if (query.type === 'servers') {\n      return ds.afserver?.name\n        ? ds\n            .getAssetServer(ds.afserver.name)\n            .then((result: PiwebapiRsp) => [result])\n            .then(metricQueryTransform)\n        : ds.getAssetServers().then(metricQueryTransform);\n    } else if (query.type === 'databases' && !!query.afServerWebId) {\n      return ds.getDatabases(query.afServerWebId, {}).then(metricQueryTransform);\n    } else if (query.type === 'databases') {\n      return ds\n        .getAssetServer(query.path)\n        .then((server) => ds.getDatabases(server.WebId ?? '', {}))\n        .then(metricQueryTransform);\n    } else if (query.type === 'databaseElements') {\n      return ds\n        .getDatabase(query.path)\n        .then((db) =>\n          ds.getDatabaseElements(db.WebId ?? '', {\n            selectedFields: 'Items.WebId%3BItems.Name%3BItems.Items%3BItems.Path%3BItems.HasChildren',\n          })\n        )\n        .then(metricQueryTransform);\n    } else if (query.type === 'elements') {\n      return ds\n        .getElement(query.path)\n        .then((element) =>\n          ds.getElements(element.WebId ?? '', {\n            selectedFields:\n              'Items.Description%3BItems.WebId%3BItems.Name%3BItems.Items%3BItems.Path%3BItems.HasChildren',\n            nameFilter: query.filter,\n          })\n        )\n        .then(metricQueryTransform);\n    } else if (query.type === 'attributes') {\n      return ds\n        .getElement(query.path)\n        .then((element) =>\n          ds.getAttributes(element.WebId ?? '', {\n            searchFullHierarchy: 'true',\n            selectedFields:\n              'Items.Type%3BItems.DefaultUnitsName%3BItems.Description%3BItems.WebId%3BItems.Name%3BItems.Path',\n            nameFilter: query.filter,\n            maxCount: query.max,\n          })\n        )\n        .then(metricQueryTransform);\n    } else if (query.type === 'dataserver') {\n      return ds.getDataServers().then(metricQueryTransform);\n    } else if (query.type === 'pipoint') {\n      return ds.piPointSearch(query.webId, query.pointName).then(metricQueryTransform);\n    }\n    return Promise.reject('Bad type');\n  }\n\n  /** PRIVATE SECTION */\n\n  /**\n   * Builds the PIWebAPI query parameters.\n   *\n   * @param {any} options - Grafana query and panel options.\n   * @returns - PIWebAPI query parameters.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  private buildQueryParameters(options: DataQueryRequest<PIWebAPIQuery>) {\n    options.targets = filter(options.targets, (target) => {\n      if (!target || !target.target || target.attributes?.length === 0 || target.target === ';' || !!target.hide) {\n        return false;\n      }\n      return !target.target.startsWith('Select AF');\n    });\n\n    if (options.maxDataPoints) {\n      options.maxDataPoints = options.maxDataPoints > 30000 ? 30000 : options.maxDataPoints;\n    }\n    options.targets = map(options.targets, (target) => {\n      const tar = {\n        enableStreaming: target.enableStreaming,\n        target: this.templateSrv.replace(target.target, options.scopedVars),\n        elementPath: this.templateSrv.replace(target.elementPath, options.scopedVars),\n        attributes: map(target.attributes, (att) => {\n          if (att.value) {\n            att.value.value = this.templateSrv.replace(att.value.value, options.scopedVars);\n          }\n          return att;\n        }),\n        segments: map(target.segments, (att) => {\n          if (att.value) {\n            att.value.value = this.templateSrv.replace(att.value.value, options.scopedVars);\n          }\n          return att;\n        }),\n        isAnnotation: !!target.isAnnotation,\n        display: !!target.display ? this.templateSrv.replace(target.display, options.scopedVars) : undefined,\n        refId: target.refId,\n        hide: target.hide,\n        interpolate: !!target.interpolate\n          ? {\n              ...target.interpolate,\n              interval: this.templateSrv.replace(target.interpolate.interval, options.scopedVars),\n            }\n          : { enable: false },\n        useLastValue: target.useLastValue || { enable: false },\n        useUnit: target.useUnit || { enable: false },\n        recordedValues: target.recordedValues || { enable: false },\n        digitalStates: target.digitalStates || { enable: false },\n        webid: target.webid ?? '',\n        regex: target.regex || { enable: false },\n        expression: target.expression || '',\n        summary: target.summary || { types: [] },\n        startTime: options.range.from,\n        endTime: options.range.to,\n        isPiPoint: !!target.isPiPoint,\n        hideError: !!target.hideError,\n        scopedVars: options.scopedVars,\n      };\n\n      if (tar.expression) {\n        tar.expression = this.templateSrv.replace(tar.expression, options.scopedVars);\n      }\n\n      if (tar.summary.types !== undefined) {\n        tar.summary.types = filter(tar.summary.types, (item) => {\n          return item !== undefined && item !== null && item !== '';\n        });\n        tar.summary.interval = !!tar.summary.interval\n          ? this.templateSrv.replace(tar.summary.interval, options.scopedVars)\n          : tar.summary.interval;\n      }\n\n      return tar;\n    });\n\n    return options;\n  }\n\n  /**\n   * Localize the eventFrame dataFrame records to Grafana Annotations.\n   * @param {any} annon - The annotation object.\n   * @param {any} data - The dataframe recrords.\n   * @returns - Grafana Annotation\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  private eventFrameToAnnotation(annon: AnnotationQuery<PIWebAPIQuery>, data: DataFrame[]): AnnotationEvent[] {\n    const annotationOptions = annon.target!;\n    const events: AnnotationEvent[] = [];\n    const currentLocale = Intl.DateTimeFormat().resolvedOptions().locale;\n\n    data.forEach((d: DataFrame) => {\n      let values = this.transformDataFrameToMap(d);\n      for (let i = 0; i < values['time'].length; i++) {\n        // replace Dataframe name using Regex\n        let title = values['title'][i];\n        if (annotationOptions.regex && annotationOptions.regex.enable) {\n          title = title.replace(new RegExp(annotationOptions.regex.search), annotationOptions.regex.replace);\n        }\n\n        // test if timeEnd is negative and if so, set it to null\n        if (values['timeEnd'][i] < 0) {\n          values['timeEnd'][i] = null;\n        }\n\n        // format the text and localize the dates to browser locale\n        let text = 'Tag: ' + title;\n        if (annotationOptions.attribute && annotationOptions.attribute.enable) {\n          text += values['attributeText'][i];\n        }\n        text += '<br />Start: ' + new Date(values['time'][i]).toLocaleString(currentLocale) + '<br />End: ';\n\n        if (values['timeEnd'][i]) {\n          text += new Date(values['timeEnd'][i]).toLocaleString(currentLocale);\n        } else {\n          text += 'Eventframe is open';\n        }\n\n        const event: AnnotationEvent = {\n          time: values['time'][i],\n          timeEnd: !!annotationOptions.showEndTime ? values['timeEnd'][i] : undefined,\n          title: title,\n          id: values['id'][i],\n          text: text,\n          tags: ['OSISoft PI'],\n        };\n\n        events.push(event);\n      }\n    });\n    return events;\n  }\n\n  /**\n   *\n   */\n  private transformDataFrameToMap(dataFrame: DataFrame): Record<string, any[]> {\n    const map: Record<string, any[]> = {};\n\n    dataFrame.fields.forEach((field) => {\n      map[field.name] = field.values.toArray();\n    });\n\n    return map;\n  }\n\n  /**\n   * Abstraction for calling the PI Web API REST endpoint\n   *\n   * @param {any} path - the path to append to the base server URL.\n   * @returns - The full URL.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  private restGet(path: string): Promise<PiwebapiRsp> {\n    return this.getResource(`${path}`).then((response: any) => {\n      return response as PiwebapiRsp;\n    });\n  }\n\n  // Get a list of all data (PI) servers\n  private getDataServers(): Promise<PiwebapiRsp[]> {\n    return this.restGet('/dataservers').then((response) => response.Items ?? []);\n  }\n  private getDataServer(name: string | undefined): Promise<PiwebapiRsp> {\n    if (!name) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/dataservers?name=' + name).then((response) => response);\n  }\n  // Get a list of all asset (AF) servers\n  private getAssetServers(): Promise<PiwebapiRsp[]> {\n    return this.restGet('/assetservers').then((response) => response.Items ?? []);\n  }\n  getAssetServer(name: string | undefined): Promise<PiwebapiRsp> {\n    if (!name) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/assetservers?path=\\\\\\\\' + name).then((response) => response);\n  }\n  getDatabase(path: string | undefined): Promise<PiwebapiRsp> {\n    if (!path) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/assetdatabases?path=\\\\\\\\' + path).then((response) => response);\n  }\n  getDatabases(serverId: string, options?: any): Promise<PiwebapiRsp[]> {\n    if (!serverId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet('/assetservers/' + serverId + '/assetdatabases').then((response) => response.Items ?? []);\n  }\n  getElement(path: string): Promise<PiwebapiRsp> {\n    if (!path) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/elements?path=\\\\\\\\' + path).then((response) => response);\n  }\n  getEventFrameTemplates(databaseId: string): Promise<PiwebapiRsp[]> {\n    if (!databaseId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet(\n      '/assetdatabases/' + databaseId + '/elementtemplates?selectedFields=Items.InstanceType%3BItems.Name%3BItems.WebId'\n    ).then((response) => {\n      return filter(response.Items ?? [], (item) => item.InstanceType === 'EventFrame');\n    });\n  }\n  getElementTemplates(databaseId: string): Promise<PiwebapiRsp[]> {\n    if (!databaseId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet(\n      '/assetdatabases/' + databaseId + '/elementtemplates?selectedFields=Items.InstanceType%3BItems.Name%3BItems.WebId'\n    ).then((response) => {\n      return filter(response.Items ?? [], (item) => item.InstanceType === 'Element');\n    });\n  }\n\n  /**\n   * @description\n   * Get the child attributes of the current resource.\n   * GET attributes/{webId}/attributes\n   * @param {string} elementId - The ID of the parent resource. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.nameFilter - The name query string used for finding attributes. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned attributes must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned attributes must be members of this template. The default is no template filter.\n   * @param {string} options.valueType - Specify that returned attributes' value type must be the given value type. The default is no value type filter.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include attributes nested further than the immediate attributes of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {string} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {string} options.showExcluded - Specified if the search should include attributes with the Excluded property set. The default is 'false'.\n   * @param {string} options.showHidden - Specified if the search should include attributes with the Hidden property set. The default is 'false'.\n   * @param {string} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields - List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getAttributes(elementId: string, options: any): Promise<PiwebapiRsp[]> {\n    let querystring =\n      '?' +\n      map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/elements/' + elementId + '/attributes' + querystring).then(\n      (response) => response.Items ?? []\n    );\n  }\n\n  /**\n   * @description\n   * Retrieve elements based on the specified conditions. By default, this method selects immediate children of the current resource.\n   * Users can search for the elements based on specific search parameters. If no parameters are specified in the search, the default values for each parameter will be used and will return the elements that match the default search.\n   * GET assetdatabases/{webId}/elements\n   * @param {string} databaseId - The ID of the parent resource. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.webId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {string} options.nameFilter - The name query string used for finding objects. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned elements must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned elements must have this template or a template derived from this template. The default is no template filter.\n   * @param {string} options.elementType - Specify that returned elements must have this type. The default type is 'Any'. See Element Type for more information.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include objects nested further than the immediate children of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {number} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {number} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields -  List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getDatabaseElements(databaseId: string, options: any): Promise<PiwebapiRsp[]> {\n    let querystring =\n      '?' +\n      map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/assetdatabases/' + databaseId + '/elements' + querystring).then(\n      (response) => response.Items ?? []\n    );\n  }\n\n  /**\n   * @description\n   * Retrieve elements based on the specified conditions. By default, this method selects immediate children of the current resource.\n   * Users can search for the elements based on specific search parameters. If no parameters are specified in the search, the default values for each parameter will be used and will return the elements that match the default search.\n   * GET elements/{webId}/elements\n   * @param {string} databaseId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.webId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {string} options.nameFilter - The name query string used for finding objects. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned elements must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned elements must have this template or a template derived from this template. The default is no template filter.\n   * @param {string} options.elementType - Specify that returned elements must have this type. The default type is 'Any'. See Element Type for more information.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include objects nested further than the immediate children of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {number} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {number} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields -  List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getElements(elementId: string, options: any): Promise<PiwebapiRsp[]> {\n    let querystring =\n      '?' +\n      map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/elements/' + elementId + '/elements' + querystring).then(\n      (response) => response.Items ?? []\n    );\n  }\n\n  /**\n   * Retrieve a list of points on a specified Data Server.\n   *\n   * @param {string} serverId - The ID of the server. See WebID for more information.\n   * @param {string} nameFilter - A query string for filtering by point name. The default is no filter. *, ?, [ab], [!ab]\n   */\n  private piPointSearch(serverId: string, nameFilter: string): Promise<PiwebapiRsp[]> {\n    let filter1 = this.templateSrv.replace(nameFilter);\n    let filter2 = `${filter1}`;\n    let doFilter = false;\n    if (filter1 !== nameFilter) {\n      const regex = /\\{(\\w|,)+\\}/g;\n      let m;\n      while ((m = regex.exec(filter1)) !== null) {\n        // This is necessary to avoid infinite loops with zero-width matches\n        if (m.index === regex.lastIndex) {\n          regex.lastIndex++;\n        }\n\n        // The result can be accessed through the `m`-variable.\n        m.forEach((match, groupIndex) => {\n          if (groupIndex === 0) {\n            filter1 = filter1.replace(match, match.replace('{', '(').replace('}', ')').replace(',', '|'));\n            filter2 = filter2.replace(match, '*');\n            doFilter = true;\n          }\n        });\n      }\n    }\n    return this.restGet('/dataservers/' + serverId + '/points?maxCount=100&nameFilter=' + filter2).then((results) => {\n      if (!!results && !!results?.Items) {\n        return doFilter ? results.Items.filter((item) => item.Name?.match(filter1)) : results.Items;\n      }\n      return [];\n    });\n  }\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { PIWebAPIConfigEditor } from './config/ConfigEditor';\nimport { PIWebAPIQueryEditor } from './query/QueryEditor';\nimport { PiWebAPIDatasource } from './datasource';\nimport { PIWebAPIQuery, PIWebAPIDataSourceJsonData } from './types';\n\nexport const plugin = new DataSourcePlugin<PiWebAPIDatasource, PIWebAPIQuery, PIWebAPIDataSourceJsonData>(\n  PiWebAPIDatasource\n)\n  .setQueryEditor(PIWebAPIQueryEditor)\n  .setConfigEditor(PIWebAPIConfigEditor);\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__781__","__WEBPACK_EXTERNAL_MODULE__531__","__WEBPACK_EXTERNAL_MODULE__7__","__WEBPACK_EXTERNAL_MODULE__241__","__WEBPACK_EXTERNAL_MODULE__959__","__WEBPACK_EXTERNAL_MODULE__269__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","FormField","LegacyForms","coerceOptions","options","jsonData","url","PIWebAPIConfigEditor","PureComponent","render","originalOptions","this","props","div","DataSourceHttpSettings","defaultUrl","dataSourceConfig","onChange","onHttpOptionsChange","showAccessOptions","h3","className","InlineField","label","labelWidth","InlineSwitch","pipoint","onPiPointChange","newFormat","onNewFormatChange","useUnit","onUseUnitChange","useExperimental","onUseExperimentalChange","useStreaming","onUseStreamingChange","inputWidth","onPIServerChange","piserver","placeholder","onAFServerChange","afserver","onAFDatabaseChange","afdatabase","event","onOptionsChange","target","checked","QueryField","tooltip","children","InlineFormLabel","width","QueryRowTerminator","QueryInlineField","QueryEditorRow","QueryRawInlineField","QueryRawEditorRow","defaultQuery","attributes","segments","regex","enable","summary","types","basis","interval","nodata","expression","interpolate","useLastValue","recordedValues","boundaryType","digitalStates","enableStreaming","isPiPoint","QueryEditorModeSwitcher","isRaw","isModalOpen","setModalOpen","useState","useEffect","Button","aria-label","icon","variant","type","onClick","ConfirmModal","isOpen","title","body","confirmText","dismissText","onConfirm","onDismiss","metricQueryTransform","response","map","item","text","Name","expandable","HasChildren","Path","split","length","Items","WebId","LABEL_WIDTH","MIN_ATTR_INPUT_WIDTH","REMOVE_LABEL","CustomLabelComponent","style","marginRight","Icon","name","PIWebAPIQueryEditor","isValueEmpty","calcBasisValueChanged","segment","metricsQuery","query","getCalcBasisSegments","calculationBasis","recordedBoundaryTypeValueChanged","getRecordedBoundaryTypeSegments","recordedBoundaryTypes","calcNoDataValueChanged","getNoDataSegments","noDataReplacement","onSummaryValueChanged","index","summaries","state","slice","splice","setState","stateCallback","getSummarySegments","summaryTypes","filter","s","indexOf","unshift","removeSummary","part","onSummaryAction","selectableValue","push","summarySegment","removeAttribute","attributeChangeValue","onAttributeAction","Array","isArray","String","match","getSegmentPathUpTo","arr","reduce","result","startsWith","checkAttributeSegments","data","datasource","ctrl","findQuery","path","metricFindQuery","assign","request","scopedVars","then","attributesResponse","validAttributes","each","attribute","substring","filteredAttributes","attrib","changedValue","templateSrv","replace","availableAttributes","catch","err","error","message","checkPiPointSegments","webId","getSelectedPIServer","pointName","webID","piServer","forEach","parts","textEditorChanged","splitAttributes","splitElements","_","getElementSegments","elements","updateArray","rawQuery","checkAfServer","queryProps","onRunQuery","defaults","hideError","display","piPointConfig","onIsPiPointChange","InlineFieldRow","grow","Input","onBlur","SegmentAsync","Component","onSegmentChange","loadOptions","allowCustomValue","inputMinWidth","disabled","getAttributeSegmentsPI","reloadOptionsOnChange","Segment","onAttributeChange","getAttributeSegmentsAF","attributeSegment","onHideErrorChange","useUnitConfig","maxNumber","parseInt","search","constructor","super","calculationBasisSegment","noDataReplacementSegment","segmentChangeValue","Promise","resolve","remove","currentSegment","afServerWebId","items","altSegments","variables","getVariables","variable","attributeText","forOwn","val","buildFromTarget","segmentsArray","attributesArray","summariesArray","cb","scopedVarsDone","componentDidMount","initialLoad","componentDidUpdate","force","_segmentsArray","e","console","elementPath","tr","join","parseRawQuery","isValidQuery","trim","targetSplit","queryChange","bind","PiWebAPIAnnotationsQueryEditor","memo","annotation","afWebId","setAfWebId","database","setDatabase","getValue","getAssetServer","AsyncSelect","getDatabases","dbs","loadingMessage","template","defaultOptions","getEventFrameTemplates","templ","showEndTime","currentTarget","categoryName","nameFilter","PiWebAPIDatasource","DataSourceWithBackend","applyTemplateVariables","targets","isAnnotation","buildQueryParameters","of","queryOptions","ds","querydepth","JSON","parse","Math","max","min","getAssetServers","server","getDatabase","db","getDatabaseElements","selectedFields","getElement","element","getElements","getAttributes","searchFullHierarchy","maxCount","getDataServers","piPointSearch","reject","hide","maxDataPoints","tar","att","refId","webid","startTime","range","from","endTime","to","annon","annotationOptions","events","currentLocale","Intl","DateTimeFormat","resolvedOptions","locale","values","transformDataFrameToMap","i","RegExp","Date","toLocaleString","time","timeEnd","id","tags","dataFrame","fields","field","toArray","getResource","restGet","getDataServer","serverId","databaseId","InstanceType","getElementTemplates","elementId","querystring","filter1","filter2","doFilter","m","exec","lastIndex","groupIndex","results","instanceSettings","getTemplateSrv","newFormatConfig","annotations","QueryEditor","prepareQuery","anno","queryType","processEvents","eventFrameToAnnotation","all","plugin","DataSourcePlugin","setQueryEditor","setConfigEditor"],"sourceRoot":""}